pipeline {
 parameters {
  choice choices: ['dev', 'stg', 'master'], description: 'please select your branch', name: 'Branch'
}
    agent any
environment {
  PATH = "/opt/maven/bin:$PATH"
}
    stages {
        stage('Hello') {
            steps {
                echo 'Hello World'
            }
        }
		stage('checkout') {
		steps {
		checkout([$class: 'GitSCM', branches: [[name: "*/${Branch}"]], extensions: [], userRemoteConfigs: [[credentialsId: 'githubcred', url: 'https://github.com/hari181842/devops.git']]])
		}
	    }
	   stage ('build') {
	   steps {
	   sh 'mvn package'
	  }
	  }
	}
	   stage ('artifact_uploader') {
	   steps {
	   script{
	   def mavempom = redaMavenPom file 'pom.xml' 
	   nexusArtifactUploader artifacts: [[artifactId: 'hello-world-war', classifier: '', file: "target/hello-world-war-${mavenpom.version}".war, type: 'war']], credentialsId: 'nexus_hari', groupId: 'com.efsavage', nexusUrl: '3.109.229.170:8081', nexusVersion: 'nexus3', protocol: 'http', repository: 'hari-repo', version: "${mavenpom.version}"
	  }
	  }
	   stage ('deploy') {
	   steps {
	   deploy adapters: [tomcat8(credentialsId: 'tomcat-cred_hari', path: '', url: 'http://3.111.66.27:8080')], contextPath: 'dev3', war: '**/*.war'
      }
	  }
    }
}	

